# Day 1 - Lab 2 : Log Analytics Customization

DevIntersection Security Workshop

## Exercise 1: Log Analytics Customization

### Task 1: Add custom logs

1. Open the Azure Portal.
2. Browse to the resource group.
3. Select the **wssecuritySUFFIX** log analytics workspace.
4. Select **Advanced Settings**.
5. Select on **Data** then select **Custom logs**.

    > **NOTE** By default, all configuration changes are automatically pushed to all agents. For Linux agents, a configuration file is sent to the Fluentd data collector.

6. Click **Add+** to open the Custom Log Wizard.

### Task 2: Import custom logs

1. Select **Choose File** and browse to the **artifacts/logfile.txt** sample file.
2. Select **Next**. The Custom Log Wizard will upload the file and list the records that it identifies.
3. Select **Next**
4. For the log collection paths, type **C:\logs\log*.txt**
5. Select **Next**
6. For the name, type **CustomSecurity_CL**
7. Select **Save**
8. Log in to the **paw-1** virtual machine
9. Copy the logs folder contents to the **c:\logs** folder

### Task 3: Search custom logs #1

1. Switch back to the log analytics workspace
2. Select **logs**
3. In the query text area, type the following:

    ```sql

    ```

### Task 4: Create Custom Fields

1. Go to Logs and use a query to retrieve the records that will have the custom field.
2. Select a record that Log Analytics will use to act as a model for extracting data to populate the custom field. You will identify the data that you want to extract from this record, and Log Analytics will use this information to determine the logic to populate the custom field for all similar records.
3. Expand the record properties, click the ellipse to the left of the top property of the record, and select Extract fields from.
4. The Field Extraction Wizard is opened, and the record you selected is displayed in the Main Example column. The custom field will be defined for those records with the same values in the properties that are selected.
5. If the selection is not exactly what you want, select additional fields to narrow the criteria. In order to change the field values for the criteria, you must cancel and select a different record matching the criteria you want.

### Task 4: Search custom logs #2

1. TODO

## Reference Links

- [Azure Monitor](https://docs.microsoft.com/en-us/azure/azure-monitor/overview)
- [Logs in Azure Monitor](https://docs.microsoft.com/en-us/azure/azure-monitor/platform/data-platform-logs)
- [Log Analytics Workspace](https://docs.microsoft.com/en-us/azure/azure-monitor/platform/design-logs-deployment)
- [Log Analytics agent overview](https://docs.microsoft.com/en-us/azure/azure-monitor/platform/log-analytics-agent)
- [Custom logs in Azure Monitor](https://docs.microsoft.com/en-us/azure/azure-monitor/platform/data-sources-custom-logs)
- [Send log data to Azure Monitor with the HTTP Data Collector API (public preview)](https://docs.microsoft.com/en-us/azure/azure-monitor/platform/data-collector-api)
- [Create custom fields in a Log Analytics workspace in Azure Monitor (Preview)](https://docs.microsoft.com/en-us/azure/azure-monitor/platform/custom-fields)
- [Parse text data in Azure Monitor logs](https://docs.microsoft.com/en-us/azure/azure-monitor/log-query/parse-text)